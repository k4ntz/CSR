FROM nvidia/cuda:11.7.1-cudnn8-devel-ubuntu22.04
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y git wget
#download miniconda
RUN wget -O /tmp/miniconda.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh && \
    bash /tmp/miniconda.sh -b -p /opt/conda && \
    rm /tmp/miniconda.sh
ENV PATH="/opt/conda/bin:$PATH"

#create env
RUN conda create -n atari python=3.9.12

SHELL ["/bin/bash", "-c"]
RUN source activate atari && \
    apt update && apt install -y software-properties-common && \
    add-apt-repository ppa:deadsnakes/ppa -y && \
    apt update

RUN source activate atari && \
    apt install -y build-essential cmake zlib1g-dev libjpeg-dev \
    python3.9-dev libsdl1.2-dev libsdl-image1.2-dev \
    libsdl-mixer1.2-dev libsdl-ttf2.0-dev \
    libsmpeg-dev libportmidi-dev libswscale-dev \
    libavformat-dev libavcodec-dev

RUN source activate atari && \
    pip install ale-py==0.7 atari-py==0.2.5 && \
    conda install -y -c conda-forge gym==0.19.0

RUN echo "source activate atari" >> ~/.bashrc
CMD ["bash"]
